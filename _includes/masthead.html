{% include base_path %}

<div class="masthead">
  <div class="masthead__inner-wrap">    
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="{{ base_path }}/">{{ site.title }}</a></li>
          {% for link in site.data.navigation.main %}
          <!-- Don't show the ones exclude -->
          <!-- https://stackoverflow.com/questions/25452429/excluding-page-from-jekyll-navigation-bar -->
            {% unless link.exclude %} 
              {% if link.url contains 'http' %}
                {% assign domain = '' %}
              {% else %}
                {% assign domain = base_path %}
              {% endif %}
              <li class="masthead__menu-item"><a href="{{ domain }}{{ link.url }}">{{ link.title }}</a></li>
            {% endunless %}
          {% endfor %}                                
        </ul> 
        <ul class="hidden-links hidden"></ul>
      </nav>
      {% if site.minimal_mistakes_skin2 %}
        <span class="togglefa" id="theme-toggle-btn">
          <i class="fas fa-sun theme-icon-light" aria-hidden="true"></i>
          <i class="fa fa-toggle-on" aria-hidden="true"></i>
          <i class="fas fa-moon theme-icon-dark" aria-hidden="true"></i>
        </span>
        <script>
          (function() {
            document.addEventListener('DOMContentLoaded', function() {
              var toggleBtn = document.getElementById('theme-toggle-btn');
              if (toggleBtn) {
                toggleBtn.addEventListener('click', function() {
                  var node1 = document.getElementById('theme_source');
                  var node2 = document.getElementById('theme_source_2');
                  var newTheme;
                  
                  if(node1.getAttribute('rel')=='stylesheet'){
                    node1.setAttribute('rel', 'stylesheet alternate'); 
                    node2.setAttribute('rel', 'stylesheet');
                    sessionStorage.setItem('theme', 'dark');
                    newTheme = 'dark';
                    
                    var lightIcon = document.querySelector('.theme-icon-light');
                    var darkIcon = document.querySelector('.theme-icon-dark');
                    if (lightIcon) lightIcon.style.opacity = '0.3';
                    if (darkIcon) darkIcon.style.opacity = '1';
                  } else {
                    node2.setAttribute('rel', 'stylesheet alternate'); 
                    node1.setAttribute('rel', 'stylesheet');
                    sessionStorage.setItem('theme', 'light');
                    newTheme = 'light';
                    
                    var lightIcon = document.querySelector('.theme-icon-light');
                    var darkIcon = document.querySelector('.theme-icon-dark');
                    if (lightIcon) lightIcon.style.opacity = '1';
                    if (darkIcon) darkIcon.style.opacity = '0.3';
                  }
                  
                  // Update map theme if map exists
                  if (typeof window.updateMapTheme === 'function') {
                    window.updateMapTheme(newTheme);
                  }
                });
              }
              
              // Set initial icon state
              var theme = sessionStorage.getItem('theme');
              var lightIcon = document.querySelector('.theme-icon-light');
              var darkIcon = document.querySelector('.theme-icon-dark');
              
              if(theme === 'dark') {
                if (lightIcon) lightIcon.style.opacity = '0.3';
                if (darkIcon) darkIcon.style.opacity = '1';
              } else {
                if (lightIcon) lightIcon.style.opacity = '1';
                if (darkIcon) darkIcon.style.opacity = '0.3';
              }
              
              // Highlight active navigation item
              var currentPath = window.location.pathname;
              var navLinks = document.querySelectorAll('.masthead__menu-item a');
              navLinks.forEach(function(link) {
                var linkPath = link.getAttribute('href');
                if (linkPath === currentPath || (currentPath === '/' && linkPath === '/')) {
                  link.style.opacity = '1';
                }
              });
            });
          })();
        </script>
      {% endif %}
    </div>
  </div>
</div>

<style>
  .masthead__inner-wrap {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #212121; /* Ensures the background color is consistent */
    padding: 0 10px; /* Adds some padding for better spacing */
    width: 100%;
  }
  .greedy-nav {
    display: flex;
    align-items: center;
    flex-grow: 1;
    background-color: #212121; /* Match the background color */
  }
  .visible-links {
    display: flex;
    align-items: center;
    margin: 0;
    padding: 0;
    list-style: none;
    gap: 0.75em;
  }
  .visible-links li {
    margin-right: 0;
  }
  .masthead__menu-item a {
    color: white;
    text-decoration: none;
    font-size: 1em;
    opacity: 0.7;
    transition: opacity 0.2s ease;
    padding: 0.5em 0;
    font-weight: 500;
    outline: none;
  }
  .masthead__menu-item a:hover {
    opacity: 1;
  }
  .masthead__menu-item a:focus {
    outline: none;
  }
  .masthead__menu-item--lg a {
    font-size: 1em;
    font-weight: 600;
    opacity: 1;
  }
  
  @media (max-width: 768px) {
    .visible-links {
      gap: 1em;
    }
  }
  .togglefa {
    color: white;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
    cursor: pointer;
    font-size: 1.2em;
  }
  .togglefa .theme-icon-light,
  .togglefa .theme-icon-dark {
    transition: opacity 0.3s ease;
  }
  .togglefa .fa-toggle-on {
    font-size: 1.1em;
  }
  .masthead__menu {
    display: flex;
    align-items: center;
    width: 100%;
    background-color: #212121; /* Match the background color */
  }
</style>
